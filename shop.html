<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å•†åº— - Aquarium Studio</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .line-banner {
      background: linear-gradient(135deg, #06c755 0%, #00b44a 100%);
      color: white;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 60px;
      z-index: 99;
      box-shadow: 0 4px 15px rgba(6, 199, 85, 0.3);
    }
    
    .line-banner-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .line-icon {
      width: 45px;
      height: 45px;
      background: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
    }
    
    .line-banner-text h3 {
      font-size: 1.1rem;
      margin-bottom: 3px;
    }
    
    .line-banner-text p {
      font-size: 0.85rem;
      opacity: 0.9;
    }
    
    .line-add-btn {
      background: white;
      color: #06c755;
      border: none;
      padding: 12px 24px;
      border-radius: 25px;
      font-weight: bold;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .line-add-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    
    .line-add-btn.added {
      background: #4CAF50;
      color: white;
    }
    
    .line-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      display: none;
    }
    
    .line-modal-overlay.show {
      display: flex;
    }
    
    .line-modal {
      background: white;
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      max-width: 350px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .line-modal h2 {
      color: #06c755;
      margin-bottom: 15px;
    }
    
    .line-modal p {
      color: #666;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .line-qr-code {
      width: 180px;
      height: 180px;
      background: #f5f5f5;
      border-radius: 10px;
      margin: 20px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
    }
    
    .line-modal-btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 10px;
    }
    
    .line-primary-btn {
      background: #06c755;
      color: white;
    }
    
    .line-secondary-btn {
      background: #f5f5f5;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- LINE Banner -->
  <div class="line-banner" id="lineBanner">
    <div class="line-banner-left">
      <div class="line-icon">ğŸ’š</div>
      <div class="line-banner-text">
        <h3 id="lineStoreName">Aquarium Studio</h3>
        <p id="lineIdDisplay">@yasonok02061</p>
      </div>
    </div>
    <button class="line-add-btn" id="lineAddBtn" onclick="addLineFriend()">
      ğŸ’š åŠ å…¥ LINE
    </button>
  </div>

  <!-- LINE Modal -->
  <div class="line-modal-overlay" id="lineModal">
    <div class="line-modal">
      <h2>ğŸ’š åŠ å…¥ LINE å¥½å‹</h2>
      <p>è«‹åŠ å…¥æˆ‘å€‘çš„ LINE å¥½å‹ï¼Œå®Œæˆå¾Œé»ã€Œæˆ‘å·²åŠ å…¥ã€å³å¯è³¼è²·å•†å“ï¼</p>
      
      <div class="line-qr-code">
        <a href="https://line.me/ti/p/@yasonok02061" target="_blank" style="text-decoration: none; font-size: 3rem;">ğŸ’š</a>
      </div>
      <p style="font-size: 0.85rem; color: #999;">é»ä¸Šæ–¹åœ–æ¨™æˆ–æŒ‰éˆ•é–‹å•Ÿ LINE</p>
      
      <h3 style="margin: 15px 0; color: #06c755;" id="modalLineId">@yasonok02061</h3>
      
      <a href="https://line.me/ti/p/@yasonok02061" target="_blank" class="line-modal-btn line-primary-btn" style="display: block; text-decoration: none;">
        ğŸ“± é–‹å•Ÿ LINE åŠ å…¥å¥½å‹
      </a>
      
      <button class="line-modal-btn line-primary-btn" onclick="confirmAddLine()" style="background: #4CAF50;">
        âœ… æˆ‘å·²åŠ å…¥å¥½å‹
      </button>
      
      <button class="line-modal-btn line-secondary-btn" onclick="closeLineModal()">
        ç¨å¾Œå†èªª
      </button>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-inner">
        <a href="index.html" class="logo">
          <span class="logo-icon">ğŸŸ</span>
          <span class="logo-text">Aquarium <span>Studio</span></span>
        </a>
        
        <nav class="nav-links">
          <a href="index.html">é¦–é </a>
          <a href="shop.html" class="active">å•†åº—</a>
          <a href="cart.html" class="cart-icon">
            ğŸ›’ è³¼ç‰©è»Š
            <span class="cart-badge" id="cartCount">0</span>
          </a>
          <a href="login.html">ğŸ‘¤ æœƒå“¡</a>
          <a href="admin.html">ç®¡ç†</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Shop Section -->
  <section class="section">
    <div class="container">
      <div class="section-header">
        <h2 id="shopTitle">ğŸ  å­”é›€é­šå•†å“</h2>
        <p id="shopSubtitle">é¸æ“‡æ‚¨å–œæ„›çš„å­”é›€é­šå“ç¨®</p>
      </div>
      
      <!-- Product Controls -->
      <div class="product-controls">
        <div class="filter-buttons">
          <button class="filter-btn active" onclick="filterProducts('all')" data-category="all">å…¨éƒ¨</button>
          <button class="filter-btn" onclick="filterProducts('ç´…è‰²ç³»')" data-category="ç´…è‰²ç³»">ğŸ”´ ç´…è‰²ç³»</button>
          <button class="filter-btn" onclick="filterProducts('é»‘è‰²ç³»')" data-category="é»‘è‰²ç³»">âš« é»‘è‰²ç³»</button>
          <button class="filter-btn" onclick="filterProducts('ç‰¹æ®Šç³»')" data-category="ç‰¹æ®Šç³»">ğŸŒˆ ç‰¹æ®Šç³»</button>
          <button class="filter-btn" onclick="ç³»')" datafilterProducts('ç¨€æœ‰-category="ç¨€æœ‰ç³»">ğŸ’ ç¨€æœ‰ç³»</button>
          <button class="filter-btn" onclick="filterProducts('è—è‰²ç³»')" data-category="è—è‰²ç³»">ğŸ”µ è—è‰²ç³»</button>
          <button class="filter-btn" onclick="filterProducts('é‡‘è‰²ç³»')" data-category="é‡‘è‰²ç³»">ğŸŸ¡ é‡‘è‰²ç³»</button>
        </div>
        
        <div class="sort-filter">
          <select id="sort-filter" onchange="sortProducts()">
            <option value="default">é è¨­æ’åº</option>
            <option value="price-asc">åƒ¹æ ¼: ä½åˆ°é«˜</option>
            <option value="price-desc">åƒ¹æ ¼: é«˜åˆ°ä½</option>
            <option value="name">åç¨±æ’åº</option>
            <option value="newest">æœ€æ–°ä¸Šæ¶</option>
          </select>
        </div>
      </div>
      
      <div class="search-info" id="search-info" style="display: none;">
        <span id="search-count">0</span> å€‹å•†å“ç¬¦åˆ "<span id="search-keyword"></span>"
        <button onclick="clearSearch()">æ¸…é™¤æœå°‹</button>
      </div>
      
      <div class="no-results" id="no-results" style="display: none;">
        <span class="no-results-icon">ğŸ”</span>
        <h3>æ²’æœ‰æ‰¾åˆ°ç›¸é—œå•†å“</h3>
        <p>è©¦è©¦å…¶ä»–é—œéµå­—æˆ–ç€è¦½å…¨å•†å“</p>
        <button class="btn btn-primary" onclick="clearSearch()">æŸ¥çœ‹å…¨éƒ¨å•†å“</button>
      </div>
      
      <!-- Product Grid -->
      <div class="product-grid" id="product-grid">
        <div class="spinner"></div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-section">
          <h3 id="footerBrand">ğŸŸ Aquarium Studio</h3>
          <p>å°ˆæ¥­å­”é›€é­šé¤Šæ®–èˆ‡è²©å”®</p>
        </div>
        <div class="footer-section">
          <h3>ğŸ“ è¯çµ¡æˆ‘å€‘</h3>
          <p id="footer-lineId">LINE: @yasonok02061</p>
          <p id="footer-phone">é›»è©±: (02) 1234-5678</p>
          <p id="footer-email">yasonok@hotmail.com</p>
        </div>
        <div class="footer-section">
          <h3>ğŸ”— å¿«é€Ÿé€£çµ</h3>
          <a href="index.html">é¦–é </a>
          <a href="shop.html">å•†åº—</a>
          <a href="cart.html">è³¼ç‰©è»Š</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2026 Aquarium Studio. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script src="js/app.js"></script>
  <script src="js/settings.js"></script>
  <script>
    let currentCategory = 'all';
    let currentSort = 'default';
    let hasAddedLine = false;
    let lineId = 'yasonok02061';
    let storeName = 'Aquarium Studio';
    
    function toggleMobileMenu() {
      const navLinks = document.querySelector('.nav-links');
      const menuBtn = document.querySelector('.mobile-menu-btn');
      navLinks.classList.toggle('active');
      menuBtn.textContent = navLinks.classList.contains('active') ? 'âœ•' : 'â˜°';
    }
    
    function loadSiteSettings() {
      if (typeof SiteSettings !== 'undefined') {
        const settings = SiteSettings.load();
        lineId = settings.contact.lineId.replace('@', '');
        storeName = settings.site.name;
        
        // Update UI
        document.getElementById('lineStoreName').textContent = storeName;
        document.getElementById('lineIdDisplay').textContent = '@' + lineId;
        document.getElementById('modalLineId').textContent = '@' + lineId;
        document.getElementById('footerBrand').innerHTML = settings.site.logo + ' ' + storeName;
        
        // Update title
        document.title = settings.site.logo + ' ' + storeName + ' - å•†åº—';
        
        // Update logo
        const logoText = document.querySelector('.logo-text');
        if (logoText) logoText.innerHTML = storeName;
      }
    }
    
    function checkLineAdded() {
      hasAddedLine = localStorage.getItem('lineAdded_' + lineId) === 'true';
      updateLineBanner();
    }
    
    function updateLineBanner() {
      const btn = document.getElementById('lineAddBtn');
      if (hasAddedLine) {
        btn.innerHTML = 'âœ… å·²åŠ å…¥å¥½å‹';
        btn.classList.add('added');
      } else {
        btn.innerHTML = 'ğŸ’š åŠ å…¥ LINE';
        btn.classList.remove('added');
      }
    }
    
    function openLineModal() {
      if (hasAddedLine) return;
      document.getElementById('lineModal').classList.add('show');
    }
    
    function closeLineModal() {
      document.getElementById('lineModal').classList.remove('show');
    }
    
    function openLineApp() {
      const lineUrl = `https://line.me/ti/p/@${lineId}`;
      window.open(lineUrl, '_blank');
    }
    
    function confirmAddLine() {
      localStorage.setItem('lineAdded_' + lineId, 'true');
      hasAddedLine = true;
      updateLineBanner();
      closeLineModal();
      AquariumApp.showToast('âœ… å·²åŠ å…¥ LINE å¥½å‹ï¼ç¾åœ¨å¯ä»¥è³¼è²·å•†å“äº†', 'success');
    }
    
    function addLineFriend() {
      // Open LINE add friend page
      const lineUrl = `https://line.me/ti/p/@${lineId}`;
      
      // Try to open in LINE app first
      window.location.href = lineUrl;
      
      // Also try opening in new tab as backup
      setTimeout(() => {
        window.open(lineUrl, '_blank');
      }, 500);
      
      // Show modal for confirmation
      document.getElementById('lineModal').classList.add('show');
    }
    
    function requireLineForAction() {
      if (!hasAddedLine) {
        AquariumApp.showToast('è«‹å…ˆåŠ å…¥ LINE å¥½å‹æ‰èƒ½è³¼è²·å•†å“', 'warning');
        addLineFriend();
        return false;
      }
      return true;
    }
    
    // Override addToCart to require LINE first
    const originalAddToCart = AquariumApp.addToCart;
    AquariumApp.addToCart = function(productId, quantity = 1) {
      if (!requireLineForAction()) return;
      originalAddToCart(productId, quantity);
    };
    
    function renderProducts(category = 'all', sort = 'default') {
      const grid = document.getElementById('product-grid');
      let products = AquariumApp.getProducts();
      
      // Filter by category
      if (category !== 'all') {
        products = products.filter(p => p.category === category);
      }
      
      // Sort
      if (sort === 'price-asc') {
        products.sort((a, b) => a.price - b.price);
      } else if (sort === 'price-desc') {
        products.sort((a, b) => b.price - a.price);
      } else if (sort === 'name') {
        products.sort((a, b) => a.name.localeCompare(b.name));
      } else if (sort === 'newest') {
        products.sort((a, b) => (b.created_at || '').localeCompare(a.created_at || ''));
      }
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸŸ</div>
            <h3>æš«ç„¡å•†å“</h3>
            <p>æ•¬è«‹æœŸå¾…æˆ‘å€‘çš„å­”é›€é­šä¸Šæ¶ï¼</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = products.map(product => createProductCard(product)).join('');
      currentCategory = category;
      currentSort = sort;
      
      // Update filter buttons
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.category === category) {
          btn.classList.add('active');
        }
      });
    }
    
    function createProductCard(product) {
      const stockClass = product.stock <= 0 ? 'out' : product.stock <= 5 ? 'low' : '';
      const stockText = product.stock <= 0 ? 'ç¼ºè²¨ä¸­' : product.stock <= 5 ? `åƒ…å‰© ${product.stock} éš»` : `åº«å­˜ ${product.stock} éš»`;
      const btnDisabled = product.stock <= 0 ? 'disabled' : '';
      const btnText = product.stock <= 0 ? 'ç¼ºè²¨' : 'åŠ å…¥è³¼ç‰©è»Š';
      
      return `
        <div class="product-card" data-id="${product.id}">
          <div class="product-image-wrapper">
            <img src="${product.image || 'images/products/default-guppy.svg'}" 
                 alt="${product.name}" 
                 class="product-image"
                 onerror="this.src='images/products/default-guppy.svg'">
            <span class="product-badge badge-new">${product.featured ? 'ç²¾é¸' : 'æ–°å“'}</span>
          </div>
          <div class="product-info">
            <span class="product-category">${product.category}</span>
            <h3 class="product-name">${product.name}</h3>
            <p class="product-description">${product.description}</p>
            <div class="product-meta">
              <span class="product-price">$${product.price}</span>
              <span class="product-stock ${stockClass}">${stockText}</span>
            </div>
            <button class="btn btn-primary product-btn add-cart" 
                    onclick="AquariumApp.addToCart(${product.id}, 1)" 
                    ${btnDisabled}>
              ğŸ›’ ${btnText}
            </button>
          </div>
        </div>
      `;
    }
    
    function filterProducts(category) {
      currentCategory = category;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.category === category) {
          btn.classList.add('active');
        }
      });
      renderProducts(category, currentSort);
    }
    
    function sortProducts() {
      currentSort = document.getElementById('sort-filter').value;
      renderProducts(currentCategory, currentSort);
    }
    
    let searchQuery = '';
    
    function handleSearch(event) {
      if (event.key === 'Enter') {
        performSearch();
      }
    }
    
    function performSearch() {
      const query = document.getElementById('search-input').value.trim();
      if (query) {
        searchQuery = query;
        performSearchFilter(query);
      } else {
        searchQuery = '';
        clearSearch();
      }
    }
    
    function performSearchFilter(query) {
      const grid = document.getElementById('product-grid');
      const products = AquariumApp.getProducts();
      const results = products.filter(p => 
        p.name.toLowerCase().includes(query.toLowerCase()) || 
        p.description.toLowerCase().includes(query.toLowerCase()) ||
        p.category.toLowerCase().includes(query.toLowerCase())
      );
      
      if (results.length === 0) {
        grid.innerHTML = '';
        document.getElementById('no-results').style.display = 'block';
        document.getElementById('search-info').style.display = 'none';
        return;
      }
      
      grid.innerHTML = results.map(product => createProductCard(product)).join('');
      document.getElementById('no-results').style.display = 'none';
      document.getElementById('search-info').style.display = 'flex';
      document.getElementById('search-count').textContent = results.length;
      document.getElementById('search-keyword').textContent = query;
    }
    
    function clearSearch() {
      searchQuery = '';
      document.getElementById('search-input').value = '';
      document.getElementById('no-results').style.display = 'none';
      document.getElementById('search-info').style.display = 'none';
      renderProducts('all', 'default');
    }
    
    function loadFooterInfo() {
      if (typeof SiteSettings !== 'undefined') {
        const settings = SiteSettings.load();
        const phoneEl = document.getElementById('footer-phone');
        const lineIdEl = document.getElementById('footer-lineId');
        const emailEl = document.getElementById('footer-email');
        
        if (phoneEl) phoneEl.textContent = 'é›»è©±: ' + settings.contact.phone;
        if (lineIdEl) lineIdEl.textContent = 'LINE: ' + settings.contact.lineId;
        if (emailEl) emailEl.textContent = settings.contact.email;
      }
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Check if already added LINE friend
      hasAddedLine = localStorage.getItem('lineAdded_' + lineId) === 'true';
      
      if (hasAddedLine) {
        // Already added - load products
        loadSiteSettings();
        loadFooterInfo();
        
        // Check URL params
        const urlParams = new URLSearchParams(window.location.search);
        const category = urlParams.get('category');
        const search = urlParams.get('search');
        
        if (category) {
          filterProducts(category);
        } else if (search) {
          performSearchFilter(search);
        } else {
          renderProducts('all', 'default');
        }
      } else {
        // Not added yet - directly redirect to LINE add friend page
        window.location.href = 'https://line.me/ti/p/@' + lineId;
      }
    });
  </script>
</body>
</html>